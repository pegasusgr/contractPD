\documentclass{article}
\usepackage{graphicx}
\usepackage{amssymb,amsmath}
\usepackage{subcaption} %That's for the subfigures
\usepackage{fullpage} %Use this if you have a problem with space.
\usepackage{tikz}
\usetikzlibrary{arrows}

\author{Stefano Duca \and Alexandros Rigos}
\title{Contracts in an Evolutionary Prisoner's Dilemma Game: A Report}

\begin{document}

\maketitle

\section{The main idea}
Here we are playing what we call a contract game in a prisoner's dilemma on a spatial lattice.

The idea is that a player can offer a part of what he earns ($\Delta$) to the other player to make it convienent to cooperate, conditional on the event of both players cooperating. Of course he might be tempted to defect but, due to the preference of errors, maybe the cooperation will be stable.

Here is the payoff matrix of the game:
%\begin{table}
%\centering
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline 
• & C & D & Delta \\ 
\hline 
C & r,r & -a,1 & r+$\Delta$, r-$\Delta$ \\ 
\hline 
D & 1,-a & 0,0 & 1, -a \\ 
\hline 
Delta & r- $\Delta$, r+$\Delta$ & -a, 1 & r,r, \\ 
\hline 
\end{tabular} 
\end{center}
%\end{table}

The player play a logit best response with parameter delta, responding to the strategy array of the previous round.

We implement the idea in several different ways:

\subsection{Logit best response:}
The players choose their strategy according to a logit best response with parameter beta, responding to the strategy array of the previous round.

This means that given an array of strategies $S^{t-1}$ at time $t-1$, player $i$ plays strategy $s_k$ at time $t$ with probability $p_k$ given by:
$$
p_{k}=\frac{e^{\beta EU\left(s_{k}\mid S_{-i}^{t-1}\right)}}{\sum_{s_{j}}e^{\beta EU\left(s_{j}\mid S_{-i}^{t-1}\right)}}
$$

where $ S_{-i}^{t-1}$ is the array representing the strategies of all agents but agent $i$
and $EU\left(s_{k}\mid S_{-i}^{t-1}\right)$ is the expected utility\footnote{Computed as the average payoff obtained by the interaction of $i$ with its nearest neighbours} of strategy $s_k$.

Below are some examples of results we obtained.
\begin{figure}[htbp] 
\centering
\begin{subfigure}[t]{0.47\textwidth}
  \centering
  %\includegraphics[width=\textwidth]{./Figures/BR_nodelta}
  \caption{Percentage of players playing each strategy in case the value of $\delta$ is 0.}
  \label{fig:BR_nodelta} 
\end{subfigure}%
~
~
\begin{subfigure}[t]{0.47\textwidth}
  \centering
  %\includegraphics[width=\textwidth]{./Figures/BR_delta}
  \caption{Percentage of players playing each strategy in case the value of $\delta$ is $0.35$. Note that for this value $r+\delta >1$ and hence $C$ is the best response to $\Delta$.}
  \label{fig:BR_delta} 
\end{subfigure}
\caption{Percentage of players playing each strategy for two different values of $\delta$.
Fig (a) shows the percentage of players defecting (green line) in the case $\delta =0$. This is the case in which the strategy $\Delta$ is equivalent to cooperation.
We can see how in fig (b) there is no difference in the level of defection even though the value of $\delta$ is such that to cooperate is a best response to the strategy $\Delta$.
The kind of lattice used in the simulation is the Von Neumann lattice.
The picture is obtained in the case of agents choosing their strategy according to a logit best response.
}
\label{fig:BR}
\end{figure} 

Unfortunately, as shown in the picture, it seems that there is no difference in the level of cooperation between the "control case" where $\delta=0$ \ref{fig:BR_nodelta} and the case where $\delta>0$  \ref{fig:BR_nodelta} and such that to cooperate is a best response to $\Delta$.


\subsection{Logit best response with 4 strategies and directed transitions}
We now introduce another strategy: -Delta. Players that use this strategy, if their opponent cooperates, will take a larger part of the pie. More specifically, they will get $r+\Delta$ and their opponent will receive $r-\Delta$. The payoff matrix is, therefore amended to be the following:
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline 
• & C & D &+Delta & -Delta  \\ 
\hline 
C & $r$ , $r$ & $-a$ , 1 & $r+\Delta$, $r-\Delta$ & $r-\Delta$, $r+\Delta$ \\ 
\hline 
D & 1 , $-a$ & 0,0 & 1, $-a$ & 1,$-a$\\ 
\hline 
+Delta & $r -\Delta$, $r+\Delta$ & $-a$, 1 & $r$ , $r$& $r-2\Delta$, $r+2\Delta$ \\ 
\hline 
-Delta & $r+\Delta$ , $r-\Delta$ & $-a$, 1 & $r+2\Delta$ , $r-2\Delta$ & $r$ ,$ r$\\ 
\hline 
\end{tabular} 
\end{center}

Similarly as in in the previous case, there is a logit rule in the way that agents switch stratetegies. Crucially, we allow only for specific transitions to tale place. These are shown in Figure \ref{diagram}.  

\begin{figure}
\begin{center}
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,
  thick,main node/.style={circle,fill=blue!20,draw,font=\sffamily\Large\bfseries}]
  \node[main node] (1) {$~C$};
  \node[main node] (2) [below left of=1] {$+\Delta$};
  \node[main node] (3) [below right of=2] {$~D$};
  \node[main node] (4) [below right of=1] {$-\Delta$};

  \path[every node/.style={font=\sffamily\small}]
    (1) edge node [left] { } (4)
        edge [bend right] node[left] { } (2)
        edge [loop above] node { } (1)
    (2) edge node [right] { } (1)
	%edge node {} (4)
        edge [loop left] node {} (2)
        edge [bend right] node[left] {} (3)
    (3) edge node [right] {} (2)
        edge [bend right] node[right] {} (4)
    (4) edge node [left] {} (3)
        edge [loop right] node {} (4)
        edge [bend right] node[right] {} (1);
\end{tikzpicture}
\end{center}
\caption{Transitions in the 4 strategy case. An arrow indicates a transition that is allowed.}\label{diagram}
\end{figure}

Some of the results the simulations gave us can be seen in figure \ref{fig:4strat}. Results show that the introduction of the $-\Delta$ strategy increases the amount of defectors. Moreover, the $-\Delta$ strategists do better than the more cooperative strategies but worse than defect.
%Results show that the directional transitions do not change the percentage of cooperators in the long run (see Figure \ref{fig:4strat}).
\begin{figure}[htbp] 
\centering
\begin{subfigure}[t]{0.47\textwidth}
  \centering
  \includegraphics[width=\textwidth]{./Figures/4strategies-nodelta}
  \caption{Percentage of players playing each strategy in case the value of $\delta$ is 0.}
  \label{fig:4strat_nodelta} 
\end{subfigure}%
~
~
\begin{subfigure}[t]{0.47\textwidth}
  \centering
  \includegraphics[width=\textwidth]{./Figures/4strategies-delta}
  \caption{Percentage of players playing each strategy in case the value of $\delta$ is $0.35$. Note that for this value $r+\delta >1$ and hence $C$ is the best response to $\Delta$.}
  \label{fig:4strat_delta} 
\end{subfigure}
\caption{Percentage of players playing each strategy for two different values of $\delta$.
Fig (a) shows the percentage of players defecting (green line) in the case $\delta =0$. This is the case in which bot strategies $\Delta$ and $-\Delta$ are equivalent to cooperation in terms of payoffs but different in terms of transitions.
We can see how in fig (b) there is significant increase in both defectors and $-\Delta$ strategists.
The kind of lattice used in the simulation is the Von Neumann lattice.
The picture is obtained in the case of agents choosing their strategy according to a logit best response with directed transitions.
}
\label{fig:4strat}
\end{figure} 

Imitation

Imitation with delta conditional on last round's decisions.

\section{Future}

\subsection{Best responders with imitators}
We are thinking of approaching the problem in a different way. In a model where players may be either (i) best responding with probability $p$ or (ii) imitating with probability $1-p$. 

We think that this might work. This would be because as soon as a few $\Delta$ strategist appear close together, best responders around them would follow $C$. More than that, imitators around them would start cooperating too. So, the idea is that a (or a few) $\Delta$ individuals may work like seeds for the spread of cooperation.
%\section{Notes on the code}
%\begin{enumerate}
%\item  So far we consider 3 types of lattice:
%0 stands for squared lattice with Von Neumann n.n. ;
%1 stands for squared lattice with Moore n.n.;
%2 stands for ring lattice.

%\item 0 is C, 1 is D and 2 is Delta
%\end{enumerate}

\end{document}
